<!DOCTYPE html>
<html lang="en" data-theme="dark">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Whispy</title>
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <script src="https://unpkg.com/peerjs@1.5.2/dist/peerjs.min.js"></script>
  <style>
    @import url('https://fonts.googleapis.com/css2?family=Cal+Sans&display=swap');

    /* THEME TOKENS */
    :root {
      --radius: 12px;
      --shadow-sm: 0 1px 3px rgba(0,0,0,.15);
      --shadow-md: 0 6px 20px rgba(0,0,0,.22);
      --blur: blur(16px);
      --sidebar-w: 320px;
      --header-h: 90px;
    }

    /* LIGHT THEME (default) */
    [data-theme="light"] {
      --bg-primary: #f7f7fb;
      --bg-secondary: #ffffff;
      --bg-tertiary: #f0f2f6;
      --bg-elevated: #ffffff;
      --bg-accent: rgba(0,0,0,.04);
      --border-subtle: rgba(0,0,0,.08);
      --border-medium: rgba(0,0,0,.16);
      --text-primary: #0b1220;
      --text-secondary: #334155;
      --text-tertiary: #64748b;
      --accent-blue: #2563eb;
      --accent-blue-hover: #1d4ed8;
      --accent-green: #059669;
      --accent-orange: #ea580c;
      --accent-red: #dc2626;
      --glass: rgba(255,255,255,.9);
    }

    /* DARK THEME */
    [data-theme="dark"] {
      --bg-primary: #0a0a0a;
      --bg-secondary: #111111;
      --bg-tertiary: #1a1a1a;
      --bg-elevated: #1b1b1b;
      --bg-accent: rgba(255,255,255,.04);
      --border-subtle: rgba(255,255,255,.08);
      --border-medium: rgba(255,255,255,.16);
      --text-primary: #ffffff;
      --text-secondary: #b5b5b5;
      --text-tertiary: #7a7a7a;
      --accent-blue: #2563eb;
      --accent-blue-hover: #1e40af;
      --accent-green: #10b981;
      --accent-orange: #f59e0b;
      --accent-red: #ef4444;
      --glass: rgba(255,255,255,.06);
    }

    

    * { box-sizing: border-box; -webkit-font-smoothing: antialiased; -moz-osx-font-smoothing: grayscale; }
html, body { height: 100%; min-height: 100%; }
body { margin: 0; height: 100%; min-height: 100%; font-family: 'Cal Sans', -apple-system, BlinkMacSystemFont, 'Segoe UI', system-ui, sans-serif; background: var(--bg-primary); color: var(--text-primary); overflow: hidden; letter-spacing: 0.04em; }

.app {
  height: 100%;
  min-height: 100%;
  display: grid;
  grid-template-rows: var(--header-h) 1fr;
  background:
    radial-gradient(55rem 35rem at 20% 90%, rgba(37, 99, 235, .10) 0%, transparent 60%),
    radial-gradient(45rem 30rem at 120% -10%, rgba(16, 185, 129, .10) 0%, transparent 60%),
    var(--bg-primary);
}

    /* HEADER */
    .header {
      position: sticky; top: 0; z-index: 20; height: var(--header-h);
      display: grid; grid-template-columns: auto 1fr auto; align-items: center; column-gap: 10px;
      padding: 10px 12px; background: var(--glass); backdrop-filter: var(--blur); border-bottom: 1px solid var(--border-subtle);
    }
    .logo { display:flex; align-items:center; gap:10px; min-width: 0; }
    .logo-icon { width: 36px; height: 36px; border-radius: 8px; display:grid; place-items:center; font-size:18px; font-weight:600; background: linear-gradient(135deg, var(--accent-blue), var(--accent-green)); color:white; box-shadow: var(--shadow-sm); }
    .logo-text { font-size: 18px; font-weight: 700; white-space: nowrap; overflow: hidden; text-overflow: ellipsis; }
    /* Connectivity dot */
    .conn-dot {
      width: 10px;
      height: 10px;
      border-radius: 50%;
      margin-left: 6px;
      margin-right: 0;
      box-shadow: none;
      display: inline-block;
      vertical-align: middle;
      transition: background 0.2s;
      border: none;
    }
    .conn-dot.connected { background: var(--accent-green); }
    .conn-dot.disconnected { background: var(--accent-red); }

    .header-actions { display:flex; align-items:center; gap:8px; }
    .icon-btn { width: 38px; height: 38px; display:grid; place-items:center; padding: 0; background: var(--bg-elevated); border: 1px solid var(--border-medium); color: var(--text-primary); border-radius: var(--radius); font-weight:600; cursor:pointer; }
    .icon-btn:hover { background: var(--bg-tertiary); transform: translateY(-1px); }

    /* CONTACT STRIP (center of header) */
    .contact-bar {
      display: flex;
      flex: 1;
      min-width: 0;
      justify-content: center;
      align-items: center;
    }
    .contact-info-centered {
      display: flex;
      flex-direction: column;
      align-items: center;
      gap: 4px;
    }
    .contact-meta {
      display: flex;
      flex-direction: column;
      align-items: center;
    }
    .contact-name-wrap {
      display: flex;
      align-items: center;
      gap: 7px;
      font-size: 14px;
      font-weight: 700;
    }
    .avatar { width: 36px; height: 36px; border-radius: 50%; object-fit: cover; border: 1px solid var(--border-medium); }
    /* .contact-info { display:flex; flex-direction:column; min-width: 0; } -- replaced by .contact-info-centered */
    .contact-name { font-size: 14px; font-weight: 700; white-space: nowrap; overflow: hidden; text-overflow: ellipsis; }
    /* .contact-status { font-size: 11px; color: var(--text-tertiary); } -- removed */

    /* LAYOUT */
    .main {
      display: grid;
      grid-template-columns: var(--sidebar-w) 1fr;
      min-height: 0;
      height: 100%;
      min-height: 0;
      transition: grid-template-columns .25s;
    }
    .sidebar.collapsed ~ .main {
      grid-template-columns: 1fr !important;
    }
    .sidebar.collapsed {
      display: none !important;
    }

    /* SIDEBAR */
    .sidebar {
      position: fixed; /* overlay above chat */
      z-index: 15;
      left: 0;
      top: var(--header-h);
      height: calc(100svh - var(--header-h));
      background: var(--bg-secondary);
      border-right: 1px solid var(--border-subtle);
      transform: translateX(0);
      transition: transform .25s ease;
      overflow: hidden;
      display: flex;
      flex-direction: column;
      width: var(--sidebar-w);
      box-shadow: var(--shadow-md);
      /* Hide by default on desktop, show only when open */
      display: none;
    }
    .sidebar:not(.collapsed) {
      display: flex;
    }
    .sidebar.collapsed { display: none !important; }

    .side-scroll { overflow-y:auto; padding: 16px; display:flex; flex-direction:column; gap: 14px; }
    .card { background: var(--bg-elevated); border:1px solid var(--border-subtle); border-radius: 16px; padding: 14px; }

    .me-card { display:flex; align-items:center; gap:12px; }
    .me-photo { width: 56px; height: 56px; border-radius: 50%; object-fit: cover; border:1px solid var(--border-medium); }
    .me-meta { display:flex; flex-direction:column; gap:4px; }
    .me-name { font-weight:700; }
    .me-sub { font-size: 12px; color: var(--text-tertiary); }

    .field { display:flex; flex-direction:column; gap:6px; }
    .field label { font-size:12px; color: var(--text-tertiary); }
    .room-input, .username-input, .link-output { background: var(--bg-tertiary); border: 1px solid var(--border-subtle); border-radius: var(--radius); padding: 10px 12px; color: var(--text-primary); font-family: 'Cal Sans', -apple-system, BlinkMacSystemFont, 'Segoe UI', system-ui, sans-serif; font-size: 16px; min-width: 0; letter-spacing: 0.05em; }
    .room-input { width: 100%; }
    .username-input { width: 100%; }
    .link-output { width: 100%; }
    .room-input:focus, .username-input:focus, .link-output:focus { outline: none; border-color: var(--accent-blue); box-shadow: 0 0 0 3px color-mix(in oklab, var(--accent-blue) 20%, transparent); }

    .btn { background: var(--bg-elevated); border: 1px solid var(--border-medium); color: var(--text-primary); padding: 10px 12px; border-radius: var(--radius); font-size: 13px; font-weight: 600; cursor: pointer; transition: transform .15s ease, background .2s ease; display:inline-flex; align-items:center; gap:8px; }
    .btn:hover:not(:disabled) { background: var(--bg-tertiary); transform: translateY(-1px); }
    .btn:disabled { opacity: .45; cursor: not-allowed; transform: none; }
    .btn-primary { background: linear-gradient(135deg, var(--accent-blue), var(--accent-blue-hover)); border-color: var(--accent-blue); color: white; }
    .btn-primary:hover:not(:disabled) { background: linear-gradient(135deg, var(--accent-blue-hover), #0f2e8a); box-shadow: var(--shadow-md); }

    .actions { display:flex; gap:8px; flex-wrap: wrap; }
    .status-badge { padding: 6px 10px; border-radius: 999px; font-size: 11px; font-weight: 700; letter-spacing: .3px; background: var(--bg-tertiary); color: var(--text-tertiary); border:1px solid var(--border-subtle); }
    .status-badge.connected { background: color-mix(in oklab, var(--accent-green) 15%, transparent); color: var(--accent-green); border-color: color-mix(in oklab, var(--accent-green) 30%, transparent); }
    .status-badge.error { background: color-mix(in oklab, var(--accent-red) 15%, transparent); color: var(--accent-red); border-color: color-mix(in oklab, var(--accent-red) 30%, transparent); }

    /* CHAT */
    .chat {
      min-width: 0;
      display: flex;
      flex-direction: column;
      background: var(--bg-secondary);
      grid-column: 1 / -1;
      width: 100%;
      height: 100%;
      min-height: 0;
      flex: 1 1 auto;
      position: relative;
    }
    .sidebar.collapsed ~ .main .chat {
      width: 100vw !important;
      max-width: 100vw !important;
    }
    .messages {
      flex: 1 1 auto;
      min-height: 0;
      overflow-y: auto;
      padding: 16px clamp(12px, 3vw, 24px);
      display: flex;
      flex-direction: column;
      gap: 14px;
      scroll-behavior: smooth;
      max-width: 100%;
      height: 100%;
      /* Ensure messages are behind sticky composer */
    }
    .sidebar.collapsed ~ .main .messages {
      max-width: 100vw !important;
      padding-left: 0 !important;
      padding-right: 0 !important;
    }
    .sidebar.collapsed ~ .main .composer {
      padding-left: 0 !important;
      padding-right: 0 !important;
    }
    .messages::-webkit-scrollbar { width: 6px; }
    .messages::-webkit-scrollbar-thumb { background: rgba(127,127,127,.25); border-radius: 3px; }

    .message { max-width: min(72%, 760px); padding: 12px 14px; border-radius: 18px; font-size: 14px; line-height: 1.45; position: relative; animation: messageSlide .25s ease-out; margin-bottom: 2px; word-wrap: break-word; }
    .message-header { display:flex; align-items:center; gap:8px; margin-bottom:6px; font-size: 11px; opacity:.75; }
    .username { font-weight: 700; color: var(--accent-blue); }
    .timestamp { color: var(--text-tertiary); font-size: 10px; }
    .message-content { white-space: pre-wrap; word-break: break-word; }
    @keyframes messageSlide { from { opacity:0; transform: translateY(8px);} to {opacity:1; transform:none;} }
    .message.incoming { align-self:flex-start; background: var(--bg-elevated); border: 1px solid var(--border-subtle); color: var(--text-primary); border-bottom-left-radius: 8px; }
    .message.outgoing { align-self:flex-end; background: linear-gradient(135deg, var(--accent-blue), var(--accent-blue-hover)); color:white; border-bottom-right-radius:8px; }
    .message.outgoing .message-header .username,
    .message.outgoing .message-header .timestamp {
      color: white;
      opacity: 0.85;
    }
    .message.system { align-self:center; background: var(--bg-accent); border: 1px solid var(--border-subtle); color: var(--text-secondary); font-size: 13px; padding: 8px 16px; max-width: 92%; text-align:center; border-radius: 20px; margin: 8px 0; }

    .file-message { display:flex; align-items:center; gap:12px; padding: 12px 14px; background: var(--bg-accent); border: 1px solid var(--border-subtle); border-radius: 14px; }
    .file-icon { width: 36px; height: 36px; border-radius: 8px; display:grid; place-items:center; font-size:18px; background: linear-gradient(135deg, var(--accent-orange), #ff6b3d); color: white; }
    .file-name { font-weight: 600; color: var(--text-primary); margin-bottom: 2px; }
    .file-size { font-size: 12px; color: var(--text-tertiary); }
    .file-link { color: white; text-decoration: underline; }
    [data-theme="light"] .file-link { color: var(--accent-blue); }

    .file-transfer-progress { background: var(--bg-accent); border: 1px solid var(--border-subtle); border-radius: 12px; padding: 12px 16px; margin: 8px 0; max-width: 320px; }
    .progress-bar { width: 100%; height: 4px; background: var(--bg-tertiary); border-radius: 2px; overflow: hidden; margin-top: 8px; }
    .progress-fill { height: 100%; background: linear-gradient(90deg, var(--accent-blue), var(--accent-green)); transition: width .25s ease; border-radius: 2px; }

    /* COMPOSER */
    .composer {
      padding: 14px clamp(12px, 3vw, 24px);
      background: var(--glass);
      backdrop-filter: var(--blur);
      border-top: 1px solid var(--border-subtle);
      position: sticky;
      bottom: 0;
      left: 0;
      right: 0;
      z-index: 10;
    }
    .composer-input { display:flex; align-items:flex-end; gap: 10px; background: var(--bg-elevated); border: 1px solid var(--border-subtle); border-radius: 18px; padding: 12px 14px; }
    .composer-input:focus-within { border-color: var(--accent-blue); box-shadow: 0 0 0 3px color-mix(in oklab, var(--accent-blue) 18%, transparent); }
    .message-input {
      flex: 1;
      background: transparent;
      border: none;
      outline: none;
      color: var(--text-primary);
      font-size: 16px; /* Prevent mobile zoom */
      line-height: 1.4;
      resize: none;
      min-height: 20px;
      max-height: 30vh;
      font-family: inherit;
      padding-top: 0.5em;
      padding-bottom: 0.5em;
      display: flex;
      align-items: center;
    }
    .composer-btn { background: transparent; border:none; color: var(--text-secondary); cursor:pointer; padding: 6px; border-radius: 10px; transition: transform .15s ease, background .2s ease, color .2s ease; width: 36px; height: 36px; display:grid; place-items:center; }
    .composer-btn:hover:not(:disabled) { color: var(--text-primary); background: var(--bg-accent); transform: translateY(-1px); }
    .composer-btn:disabled { opacity: .35; cursor:not-allowed; }
    .send-btn { background: var(--accent-blue) !important; color: white !important; border-radius: 12px; }
    .send-btn:hover:not(:disabled) { background: var(--accent-blue-hover) !important; transform: scale(1.05); }
    #fileBtn { font-size: 1.2em; margin-right: 4px; }
    .composer { padding-bottom: calc(14px + env(safe-area-inset-bottom)); }

    /* OVERLAY for mobile sidebar */
    .overlay {
      display: none;
      position: fixed;
      inset: var(--header-h) 0 0 0;
      background: rgba(0,0,0,.35);
      z-index: 14;
    }
    .overlay.show {
      display: block;
    }
    @media (max-width: 900px) {
      :root { --sidebar-w: 88vw; }
      .sidebar { position: fixed; left:0; top: var(--header-h); bottom:0; width: var(--sidebar-w); box-shadow: var(--shadow-md); display: flex; }
      .sidebar.collapsed { transform: translateX(calc(-1 * var(--sidebar-w))); display: none !important; }
      .contact-name { font-size: 15px; }
      .avatar { width: 40px; height: 40px; }
      .chat { min-width: 0; width: 100vw; max-width: 100vw; }
      .messages { padding-left: 6vw; padding-right: 6vw; max-width: 100vw; }
      .composer { padding-left: 6vw; padding-right: 6vw; }
      .composer-input { width: 100%; margin: 0 auto; }
    }
    @media (min-width: 900px) {
      .sidebar {
        position: fixed;
        left: 0;
        top: var(--header-h);
        height: calc(100svh - var(--header-h));
        width: var(--sidebar-w);
        box-shadow: var(--shadow-md);
        display: none;
      }
      .sidebar:not(.collapsed) {
        display: flex;
      }
      .overlay {
        display: none;
        position: fixed;
        inset: var(--header-h) 0 0 0;
        background: rgba(0,0,0,.35);
        z-index: 14;
      }
      .overlay.show {
        display: block;
      }
    }

    /* UTIL */
    .hidden { display:none !important; }

    /* Toast notification */
    .toast {
      position: fixed;
      bottom: 24px;
      left: 50%;
      transform: translateX(-50%);
      background: var(--bg-elevated);
      color: var(--text-primary);
      padding: 12px 24px;
      border-radius: 12px;
      font-size: 14px;
      font-weight: 500;
      box-shadow: var(--shadow-md);
      border: 1px solid var(--border-subtle);
      z-index: 1000;
      opacity: 0;
      transition: opacity 0.2s ease;
      pointer-events: none;
    }
    .toast.show {
      opacity: 1;
    }

    /* RESPONSIVE */
    @media (max-width: 900px) {
      :root { --sidebar-w: 88vw; }
      .sidebar { position: fixed; left:0; top: var(--header-h); bottom:0; width: var(--sidebar-w); box-shadow: var(--shadow-md); }
      .sidebar.collapsed { transform: translateX(calc(-1 * var(--sidebar-w))); }
      .contact-name { font-size: 15px; }
      .avatar { width: 40px; height: 40px; }
     .chat { min-width: 0; width: 100vw; max-width: 100vw; }
     .messages { padding-left: 6vw; padding-right: 6vw; max-width: 100vw; }
     .composer { padding-left: 6vw; padding-right: 6vw; }
     .composer-input { width: 100%; margin: 0 auto; }
    }

    @media (max-width: 520px) {
      .message { max-width: 98vw; }
      .composer-input { width: 100%; margin: 0 auto; }
      .composer { padding-left: 2vw; padding-right: 2vw; }
    }

    @media (max-width: 520px) {
      .message.system {
        writing-mode: unset !important;
        text-orientation: unset !important;
        white-space: normal !important;
        max-width: 96vw;
        text-align: center;
        margin: 8px auto;
        padding-left: 8px;
        padding-right: 8px;
      }
    }

    /* DRAG & DROP highlight */
    .messages.drag-over { background: color-mix(in oklab, var(--accent-blue) 12%, transparent); border: 2px dashed var(--accent-blue); border-radius: 16px; }

    /* Loading dots */
    .loading-dots { display:inline-flex; gap:4px; }
    .loading-dots span { width:4px; height:4px; border-radius:50%; background: currentColor; opacity:.4; animation: loadingDot 1.2s infinite both; }
    .loading-dots span:nth-child(1) { animation-delay: -.32s; }
    .loading-dots span:nth-child(2) { animation-delay: -.16s; }
    @keyframes loadingDot { 0%,80%,100%{opacity:.4;} 40%{opacity:1;} }

    /* Invite Overlay Styles */
.invite-overlay {
  position: fixed;
  inset: 0;
  z-index: 2000;
  background: linear-gradient(120deg, #f6f8fa 0%, #e9f3ff 100%);
  display: flex;
  align-items: center;
  justify-content: center;
  min-height: 100vh;
  min-width: 100vw;
  color: #333333;
  animation: fadeIn 0.7s;
  padding: 0;
}
.invite-overlay.hidden { display: none !important; }
.invite-content {
  background: rgba(255,255,255,0.96);
  border-radius: 28px;
  box-shadow: 0 8px 40px 0 rgba(60,60,90,0.10), 0 1.5px 8px 0 rgba(37,99,235,0.07);
  padding: 38px 20px 28px 20px;
  max-width: 370px;
  width: 96vw;
  text-align: center;
  display: flex;
  flex-direction: column;
  align-items: center;
  gap: 18px;
  backdrop-filter: blur(18px) saturate(1.2);
  border: 1.5px solid rgba(200,210,255,0.18);
}
.invite-logo {
  font-size: 44px;
  margin-bottom: 0px;
  background: linear-gradient(120deg, #2563eb 30%, #10b981 100%);
  -webkit-background-clip: text;
  -webkit-text-fill-color: transparent;
  background-clip: text;
  text-fill-color: transparent;
  display: flex;
  justify-content: center;
  align-items: center;
}
.invite-host {
  font-size: 1.1rem;
  color: #2563eb;
  font-weight: 600;
  margin-bottom: 10px;
}
  </style>
</head>
<body>
<!-- Modern Homepage Overlay -->
<div id="homepage" class="homepage-overlay">
  <div class="homepage-content stepper">
    <button class="stepper-close" id="stepperClose" title="Close" style="display:none">×</button>
    <div class="homepage-logo">💬</div>
    <h1>Whispy Chat</h1>
    <p class="homepage-lead">A minimalist peer-to-peer chat application focused on privacy and simplicity.</p>
    <ul class="homepage-features">
      <li>
        <span>🔒</span>
        <strong>End-to-End Private</strong>
        <p>Direct peer-to-peer connections with no server in between.</p>
      </li>
      <li>
        <span>⚡️</span>
        <strong>Instant Setup</strong>
        <p>No registration or installation required. Start chatting immediately.</p>
      </li>
      <li>
        <span>📱</span>
        <strong>Cross Platform</strong>
        <p>Works on any device with a modern web browser.</p>
      </li>
    </ul>
    <button id="stepperNext" class="homepage-btn">Start Chatting</button>
    <div id="toast" class="toast">Room code copied to clipboard!</div>
    <div class="homepage-footer">
      <div class="footer-links">
        <button onclick="showPrivacyPolicy()" class="footer-link">Privacy Policy</button>
        <span class="footer-dot">•</span>
        <button onclick="showTerms()" class="footer-link">Terms of Service</button>
        <span class="footer-dot">•</span>
        <button onclick="showFAQ()" class="footer-link">FAQ</button>
        
      </div>
      <a href="https://buymeacoffee.com/whispy" target="_blank" rel="noopener" class="footer-link">☕️ Buy me a coffee</a>
      <div></div><br>
      <div class="footer-copyright">© Whispy 2025</div>
    </div>

    <!-- Privacy Policy Overlay -->
    <div id="privacyOverlay" class="legal-overlay">
      <div class="legal-content">
        <button class="close-btn" onclick="hidePrivacyPolicy()">×</button>
        <h2>Privacy Policy</h2>
        <div class="legal-text">
          <p><strong>Last Updated: August 12, 2025</strong></p>
          
          <h3>1. Information We Don't Collect</h3>
          <p>Whispy Chat is designed with privacy at its core. We do not:</p>
          <ul>
            <li>Collect or store any personal information</li>
            <li>Track user behavior or analytics</li>
            <li>Use cookies or similar tracking technologies</li>
            <li>Store chat messages or file transfers</li>
            <li>Maintain user accounts or profiles</li>
          </ul>

          <h3>2. How It Works</h3>
          <p>Whispy Chat operates on a peer-to-peer basis, meaning:</p>
          <ul>
            <li>Messages are sent directly between users</li>
            <li>No data passes through our servers</li>
            <li>All data exists only in your browser during the active session</li>
            <li>Once you close the tab, all data is permanently deleted</li>
          </ul>

          <h3>3. Technical Implementation</h3>
          <p>We use WebRTC technology for direct peer-to-peer connections. The only server interaction is for initial peer discovery, which contains no personal data.</p>

          <h3>4. Data Security</h3>
          <p>While we ensure secure peer-to-peer connections, users should:</p>
          <ul>
            <li>Not share sensitive personal information</li>
            <li>Be mindful of files they share</li>
            <li>Verify they're chatting with their intended recipient</li>
          </ul>

          <h3>5. Changes to This Policy</h3>
          <p>We may update this policy and will notify users of any changes through the platform.</p>

          <h3>6. Contact</h3>
          <p>For privacy concerns, contact: privacy@whispy.chat</p>
        </div>
      </div>
    </div>

    <!-- Terms of Service Overlay -->
    <div id="termsOverlay" class="legal-overlay">
      <div class="legal-content">
        <button class="close-btn" onclick="hideTerms()">×</button>
        <h2>Terms of Service</h2>
        <div class="legal-text">
          <p><strong>Last Updated: August 12, 2025</strong></p>

          <h3>1. Acceptance of Terms</h3>
          <p>By using Whispy Chat, you agree to these Terms of Service. If you disagree with any part of the terms, you may not access the service.</p>

          <h3>2. Prohibited Uses</h3>
          <p>You agree not to use Whispy Chat for:</p>
          <ul>
            <li>Any illegal activities</li>
            <li>Harassment or abuse</li>
            <li>Sharing malicious software</li>
            <li>Spamming or automated messaging</li>
            <li>Impersonating others</li>
            <li>Sharing content that infringes on intellectual property rights</li>
            <li>Any activity that could harm other users or the service</li>
          </ul>

          <h3>3. User Responsibilities</h3>
          <p>Users are responsible for:</p>
          <ul>
            <li>All content they share</li>
            <li>Ensuring they have rights to share any content</li>
            <li>Maintaining the security of their connections</li>
            <li>Following applicable laws and regulations</li>
          </ul>

          <h3>4. Disclaimer of Warranties</h3>
          <p>The service is provided "as is" without warranties of any kind, either express or implied. We do not guarantee uninterrupted or error-free service.</p>

          <h3>5. Limitation of Liability</h3>
          <p>Whispy Chat shall not be liable for any indirect, incidental, special, consequential, or punitive damages resulting from your use or inability to use the service.</p>

          <h3>6. Termination</h3>
          <p>We reserve the right to terminate or suspend access to our service immediately, without prior notice, for any conduct that we believe violates these Terms of Service.</p>

          <h3>7. Governing Law</h3>
          <p>These terms shall be governed by and construed in accordance with the laws of the jurisdiction in which we operate.</p>

          <h3>8. Changes to Terms</h3>
          <p>We reserve the right to modify these terms at any time. We will notify users of any changes by updating the date at the top of this agreement.</p>
        </div>
      </div>
    </div>

    <!-- FAQ Overlay -->
    <div id="faqOverlay" class="legal-overlay">
      <div class="legal-content">
        <button class="close-btn" onclick="hideFAQ()">×</button>
        <h2>Frequently Asked Questions</h2>
        <div class="legal-text">
          <div class="faq-item">
            <h3>What is Whispy Chat?</h3>
            <p>Whispy Chat is a private, peer-to-peer chat application that allows direct communication between users without storing any data on servers.</p>
          </div>

          <div class="faq-item">
            <h3>How secure is Whispy Chat?</h3>
            <p>Messages are sent directly between users using encrypted WebRTC connections. No messages or files are stored on servers, and all data is deleted when you close your browser tab.</p>
          </div>

          <div class="faq-item">
            <h3>Do I need an account?</h3>
            <p>No. Whispy Chat doesn't require registration or accounts. Simply create or join a room to start chatting.</p>
          </div>

          <div class="faq-item">
            <h3>How do I start a chat?</h3>
            <p>Click "Start Chatting," then either create a new room or join an existing one with a room code.</p>
          </div>

          <div class="faq-item">
            <h3>Can I share files?</h3>
            <p>Yes, you can share files directly with your chat partner. Files are transferred peer-to-peer and are not stored on any servers.</p>
          </div>

          <div class="faq-item">
            <h3>What happens to my messages?</h3>
            <p>Messages exist only in your browser during the active chat session. Once you close the tab, all data is permanently deleted.</p>
          </div>

          <div class="faq-item">
            <h3>Is there a message history?</h3>
            <p>No. To maintain privacy, we don't store any message history. Messages are only available during the active chat session.</p>
          </div>

          <div class="faq-item">
            <h3>What browsers are supported?</h3>
            <p>Whispy Chat works on all modern browsers that support WebRTC, including Chrome, Firefox, Safari, and Edge.</p>
          </div>

          <div class="faq-item">
            <h3>How can I report abuse?</h3>
            <p>While we don't store messages or user data, you can report abuse to support@whispy.chat.</p>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>
<div class="app" id="appMain" style="display:none;">
  <header class="header">
    <div class="logo" title="Whispy">
      <div class="logo-icon">💬</div>
      <div class="logo-text">Whispy</div>
    </div>

    <!-- Redesigned contact bar: stacked, centered, dot next to name -->
    <div class="contact-bar">
      <div class="contact-info-centered">
        <img id="contactAvatar" class="avatar" alt="Contact avatar" src="https://picsum.photos/seed/placeholder/96" />
        <div class="contact-meta">
          <span class="contact-name-wrap">
            <span id="contactName" class="contact-name">Connecting</span>
            <span id="connDot" class="conn-dot disconnected" title="Connection status"></span>
          </span>
        </div>
      </div>
    </div>

    <div class="header-actions">
      <button id="sidebarToggle" class="icon-btn" title="Open menu">☰</button>
      <button id="themeToggle" class="icon-btn" title="Toggle theme">🌓</button>
    </div>
  </header>

  <div class="main">
    <!-- Collapsible Sidebar (contains everything from the old top bar except the logo) -->
    <aside id="sidebar" class="sidebar collapsed" aria-label="Controls sidebar">
      <div class="side-scroll">
        <div class="card me-card">
          <img id="meAvatar" class="me-photo" alt="Your photo" src="" />
          <div class="me-meta">
            <div id="meName" class="me-name">Anonymous</div>
            <div class="me-sub">Your contact card</div>
          </div>
        </div>

        <div class="card field">
          <label for="usernameInput">Your name</label>
          <input id="usernameInput" class="username-input" placeholder="Your name" value="Anonymous" />
          <small style="color:var(--text-tertiary)">Updating will reflect under your photo and to your peer.</small>
        </div>

        <div class="card field">
          <label for="roomCode">Room code</label>
          <input id="roomCode" class="room-input" placeholder="Room code…" />
          <div class="actions">
            <button id="createBtn" class="btn btn-primary" title="Create room">✨ <span>Create</span></button>
            <button id="joinBtn" class="btn" title="Join room">🔗 <span>Join</span></button>
          </div>
        </div>

        <div class="card field">
          <label for="linkOut">Share link</label>
          <input id="linkOut" class="link-output" placeholder="Share link will appear here" readonly />
          <div class="actions">
            <button id="copyLink" class="btn" title="Copy link">📋 Copy</button>
            <span id="status" class="status-badge" title="Connection status">Disconnected</span>
            <span id="debugInfo" class="status-badge" title="Peer info">Peer: —</span>
          </div>
        </div>
      </div>
    </aside>

    <div id="overlay" class="overlay"></div>

    <!-- Chat area -->
    <section class="chat">
      <div id="messages" class="messages"></div>
      <div class="composer">
        <div class="composer-input">
          <textarea id="textInput" class="message-input" placeholder="Type a message…" disabled rows="1"></textarea>
          <button id="fileBtn" class="composer-btn" title="Send file" disabled>📎</button>
          <button id="sendBtn" class="composer-btn send-btn" title="Send" disabled>➤</button>
          <input id="fileInput" type="file" class="hidden" />
        </div>
      </div>
      <div class="chat-footer">

        <span class="footer-text">Made With ❤️ in LA</span><br>
        <a href="https://buymeacoffee.com/whispy" target="_blank" rel="noopener" class="bmc-link">☕️ Buy me a coffee</a>
      </div>
    </section>
  </div>
</div>

<!-- Invite Overlay for joining via link -->
<div id="inviteOverlay" class="invite-overlay hidden">
  <div class="invite-content">
    <div class="invite-logo">💬</div>
    <h2 id="inviteTitle">You've been invited!</h2>
    <div id="inviteHost" class="invite-host">Room by <span id="inviteHostName">Anonymous</span></div>
    <button id="inviteStartBtn" class="homepage-btn">Start Chatting</button>
  </div>
</div>

<script>
// ---- Helpers ----
const $ = (id) => document.getElementById(id);
const statusEl = $('status');
const connDot = document.getElementById('connDot');
const messagesEl = $('messages');
const roomInput = $('roomCode');
const linkOut = $('linkOut');
const debugInfo = $('debugInfo');
const textInput = $('textInput');
const sendBtn = $('sendBtn');
const fileBtn = $('fileBtn');
const usernameInput = $('usernameInput');
const themeToggle = $('themeToggle');
const sidebar = $('sidebar');
const sidebarToggle = $('sidebarToggle');
const overlay = $('overlay');
const meAvatar = $('meAvatar');
const meName = $('meName');
const contactAvatar = $('contactAvatar');
const contactName = $('contactName');

let currentUsername = 'Anonymous';
let fileTransfers = new Map();
let myAvatarSeed = null;
let myAvatarUrl = '';
let peerProfile = { name: 'Connecting', avatar: 'https://picsum.photos/seed/placeholder/96' };

// Theme — respect system, remember choice
(function initTheme(){
  try {
    const saved = localStorage.getItem('whisper-theme');
    const systemDark = window.matchMedia && window.matchMedia('(prefers-color-scheme: dark)').matches;
    const start = saved || (systemDark ? 'dark' : 'light');
    document.documentElement.setAttribute('data-theme', start);
  } catch{}
})();

themeToggle.addEventListener('click', () => {
  const cur = document.documentElement.getAttribute('data-theme') || 'dark';
  const next = cur === 'dark' ? 'light' : 'dark';
  document.documentElement.setAttribute('data-theme', next);
  try { localStorage.setItem('whisper-theme', next); } catch{}
});

function escapeHTML(str){
  return str.replace(/[&<>"']/g, s => ({'&':'&amp;','<':'&lt;','>':'&gt;','"':'&quot;','\'':'&#039;'}[s]));
}

// Sidebar open/close
function setSidebar(open) {
  const shouldOpen = !!open;
  sidebar.classList.toggle('collapsed', !shouldOpen);
  overlay.classList.toggle('show', shouldOpen && window.matchMedia('(max-width: 900px)').matches);
}
sidebarToggle.addEventListener('click', ()=> setSidebar(sidebar.classList.contains('collapsed')));
overlay.addEventListener('click', ()=> setSidebar(false));

// Avatar utilities (Lorem Picsum)
function ensureAvatar() {
  try {
    myAvatarSeed = localStorage.getItem('whisper-avatar-seed');
    if (!myAvatarSeed) {
      myAvatarSeed = Math.random().toString(36).slice(2);
      localStorage.setItem('whisper-avatar-seed', myAvatarSeed);
    }
  } catch { myAvatarSeed = Math.random().toString(36).slice(2); }
  myAvatarUrl = `https://picsum.photos/seed/${encodeURIComponent(myAvatarSeed)}/200`;
  meAvatar.src = myAvatarUrl;
}
ensureAvatar();

function updateContactStrip() {
  // Always show the latest peerProfile name and avatar
  if (contactAvatar && peerProfile && peerProfile.avatar) {
    contactAvatar.src = peerProfile.avatar;
  }
  if (contactName) {
    contactName.textContent = peerProfile && peerProfile.name ? peerProfile.name : 'Connecting';
  }
}

// Update username when changed
usernameInput.addEventListener('input', (e) => {
  currentUsername = e.target.value.trim() || 'Anonymous';
  meName.textContent = currentUsername;
  // Save as last host name for invite overlay
  try { localStorage.setItem('whisper-last-host', currentUsername); } catch {}
  // Broadcast live name change to peer
  if (conn && conn.open) {
    try { conn.send(JSON.stringify({ type: 'profile', name: currentUsername, avatar: myAvatarUrl })); } catch {}
  }
});

function setStatus(txt, type = 'default') {
  statusEl.textContent = txt;
  statusEl.className = 'status-badge' + (type !== 'default' ? ' ' + type : '');
  // Update header dot
  if (connDot) {
    if (type === 'connected') {
      connDot.classList.add('connected');
      connDot.classList.remove('disconnected');
      connDot.title = 'Connected';
    } else if (type === 'error') {
      connDot.classList.remove('connected');
      connDot.classList.add('disconnected');
      connDot.title = 'Disconnected';
    } else {
      connDot.classList.remove('connected');
      connDot.classList.add('disconnected');
      connDot.title = 'Disconnected';
    }
  }
  updateContactStrip();
}

function getTimestamp() {
  const now = new Date();
  return now.toLocaleTimeString([], { hour: '2-digit', minute: '2-digit' });
}

function appendSys(text) {
  const d = document.createElement('div');
  d.className = 'message system';
  d.textContent = text;
  messagesEl.appendChild(d);
  messagesEl.scrollTop = messagesEl.scrollHeight;
}

function appendMsg(text, mine = false, username = null, timestamp = null, avatar = null) {
  // If this is an incoming message, update peerProfile name and avatar if present
  if (!mine) {
    if (username && peerProfile.name !== username) {
      peerProfile.name = username;
    }
    // If avatar is present, use it. Otherwise, assign a random avatar seed if not already set.
    if (avatar && peerProfile.avatar !== avatar) {
      peerProfile.avatar = avatar;
    } else if (!peerProfile.avatar || peerProfile.avatar === 'https://picsum.photos/seed/placeholder/96') {
      if (!peerProfile._seed) {
        // Generate a random seed for this peer for this session
        peerProfile._seed = Math.random().toString(36).slice(2);
      }
      peerProfile.avatar = `https://picsum.photos/seed/${encodeURIComponent(peerProfile._seed)}/96`;
    }
    updateContactStrip();
  }
  const d = document.createElement('div');
  d.className = `message ${mine ? 'outgoing' : 'incoming'}`;

  const displayUsername = username || (mine ? currentUsername : (peerProfile.name || 'Guest'));
  const displayTime = timestamp || getTimestamp();

  const header = document.createElement('div');
  header.className = 'message-header';
  const u = document.createElement('span'); u.className = 'username'; u.textContent = displayUsername;
  const t = document.createElement('span'); t.className = 'timestamp'; t.textContent = displayTime;
  header.append(u,t);

  const content = document.createElement('div');
  content.className = 'message-content';
  content.textContent = text; // prevent XSS

  d.append(header, content);
  messagesEl.appendChild(d);
  messagesEl.scrollTop = messagesEl.scrollHeight;
}

function createFileTransferProgress(transferId, filename, size) {
  const d = document.createElement('div');
  d.className = 'message incoming';
  d.id = `transfer-${transferId}`;
  d.innerHTML = `
    <div class="file-transfer-progress">
      <div style="display:flex; align-items:center; gap:8px; margin-bottom:4px;">
        <span>📥</span>
        <div>
          <div style="font-weight:600; font-size:13px;">${escapeHTML(filename)}</div>
          <div style="font-size:11px; color: var(--text-secondary);">${prettyBytes(size)}</div>
        </div>
      </div>
      <div class="progress-bar"><div class="progress-fill" style="width:0%"></div></div>
      <div style="font-size:11px; color: var(--text-secondary); margin-top:4px;">Receiving…</div>
    </div>`;
  messagesEl.appendChild(d);
  messagesEl.scrollTop = messagesEl.scrollHeight;
  return d;
}

function updateFileTransferProgress(transferId, progress) {
  const element = document.getElementById(`transfer-${transferId}`);
  if (element) {
    const progressFill = element.querySelector('.progress-fill');
    const statusText = element.querySelector('.file-transfer-progress > div:last-child');
    if (progressFill) progressFill.style.width = `${progress}%`;
    if (statusText) statusText.textContent = `${progress.toFixed(1)}% received`;
  }
}

function appendFile(name, size, url, mine = false, username = null, timestamp = null, mimeType = '') {
  // If this is an incoming message, update peerProfile name and avatar if present
  if (!mine) {
    if (username && peerProfile.name !== username) {
      peerProfile.name = username;
    }
    // Update contact info in the UI
    updateContactStrip();
  }
  
  const d = document.createElement('div');
  d.className = `message ${mine ? 'outgoing' : 'incoming'}`;

  // Header with username and timestamp
  const header = document.createElement('div');
  header.className = 'message-header';
  header.innerHTML = `
    <span class="username">${escapeHTML(username || (mine ? currentUsername : 'Guest'))}</span>
    <span class="timestamp">${timestamp || getTimestamp()}</span>
  `;

  // File preview container
  const wrap = document.createElement('div');
  wrap.className = 'message-content';

  // Determine file type and icon
  const isImage = /\.(jpg|jpeg|png|gif|webp|avif)$/i.test(name) || mimeType.startsWith('image/');
  const isVideo = /\.(mp4|webm|mov|avi|mkv)$/i.test(name) || mimeType.startsWith('video/');
  const isAudio = /\.(mp3|wav|ogg|m4a)$/i.test(name) || mimeType.startsWith('audio/');
  const isPDF = /\.pdf$/i.test(name) || mimeType === 'application/pdf';
  const isArchive = /\.(zip|rar|7z|tar|gz)$/i.test(name);
  
  let fileIcon = '📄'; // Default
  if (isImage) fileIcon = '🖼️';
  else if (isVideo) fileIcon = '🎥';
  else if (isAudio) fileIcon = '🎵';
  else if (isPDF) fileIcon = '📕';
  else if (isArchive) fileIcon = '📦';

  // Handle different file types
  if (isImage) {
    wrap.style.margin = '-8px -8px -4px -8px'; // Reduce padding around image
    wrap.innerHTML = `
      <a href="${url}" download="${escapeHTML(name)}" target="_blank" rel="noopener" style="display:block; cursor:pointer; text-decoration:none;">
        <img src="${url}" alt="${escapeHTML(name)}" 
             style="max-width:min(320px, 90vw); max-height:240px; border-radius:10px; display:block; margin-bottom:2px;">
        <div style="font-size: 11px; color: var(--text-tertiary); padding: 0 8px 4px 8px;">
          ${escapeHTML(name)} • ${prettyBytes(size)}
        </div>
      </a>
    `;
  } else if (isVideo) {
    wrap.innerHTML = `
      <div class="file-message">
        <div class="file-icon">${fileIcon}</div>
        <div class="file-info">
          <div class="file-name">
            <a class="file-link" href="${url}" download="${escapeHTML(name)}" target="_blank" rel="noopener">
              ${escapeHTML(name)}
            </a>
          </div>
          <div class="file-size">${prettyBytes(size)}</div>
        </div>
      </div>
      <div style="margin-top:8px;">
        <video src="${url}" controls style="max-width:min(320px, 90vw); border-radius:10px;"></video>
      </div>
    `;
  } else {
    wrap.innerHTML = `
      <div class="file-message">
        <div class="file-icon">${fileIcon}</div>
        <div class="file-info">
          <div class="file-name">
            <a class="file-link" href="${url}" download="${escapeHTML(name)}" target="_blank" rel="noopener">
              ${escapeHTML(name)}
            </a>
          </div>
          <div class="file-size">${prettyBytes(size)}</div>
        </div>
      </div>
    `;
  
  if (isImage) {
    // For images, just show the clickable preview
    wrap.innerHTML = `
      <a href="${url}" download="${escapeHTML(name)}" target="_blank" rel="noopener" style="display:block; cursor:pointer;">
        <img src="${url}" alt="${escapeHTML(name)}" 
             style="max-width:min(320px, 90vw); max-height:240px; border-radius:10px; display:block;">
        <div style="font-size: 12px; color: var(--text-tertiary); margin-top: 4px;">
          ${escapeHTML(name)} • ${prettyBytes(size)}
        </div>
      </a>
    `;
  } else if (isVideo) {
    // For videos, show file info and player
    wrap.innerHTML = `
      <div class="file-message">
        <div class="file-icon">${fileIcon}</div>
        <div class="file-info">
          <div class="file-name">
            <a class="file-link" href="${url}" download="${escapeHTML(name)}" target="_blank" rel="noopener">
              ${escapeHTML(name)}
            </a>
          </div>
          <div class="file-size">${prettyBytes(size)}</div>
        </div>
      </div>
      <div style="margin-top:8px;">
        <video src="${url}" controls style="max-width:min(320px, 90vw); border-radius:10px;"></video>
      </div>
    `;
  } else if (isAudio) {
    // For audio, show file info and player
    wrap.innerHTML = `
      <div class="file-message">
        <div class="file-icon">${fileIcon}</div>
        <div class="file-info">
          <div class="file-name">
            <a class="file-link" href="${url}" download="${escapeHTML(name)}" target="_blank" rel="noopener">
              ${escapeHTML(name)}
            </a>
          </div>
          <div class="file-size">${prettyBytes(size)}</div>
        </div>
      </div>
      <div style="margin-top:8px;">
        <audio src="${url}" controls style="width:100%;"></audio>
      </div>
    `;
  } else {
    // For other files, show just the file info row
    wrap.innerHTML = `
      <div class="file-message">
        <div class="file-icon">${fileIcon}</div>
        <div class="file-info">
          <div class="file-name">
            <a class="file-link" href="${url}" download="${escapeHTML(name)}" target="_blank" rel="noopener">
              ${escapeHTML(name)}
            </a>
          </div>
          <div class="file-size">${prettyBytes(size)}</div>
        </div>
      </div>
    `;
  }
  }

  d.appendChild(header);
  d.appendChild(wrap);
  messagesEl.appendChild(d);
  messagesEl.scrollTop = messagesEl.scrollHeight;
}

function getMimeType(filename) {
  const ext = filename.split('.').pop()?.toLowerCase();
  const mimeTypes = {
    // Images
    'jpg': 'image/jpeg',
    'jpeg': 'image/jpeg',
    'png': 'image/png',
    'gif': 'image/gif',
    'webp': 'image/webp',
    'avif': 'image/avif',
    'svg': 'image/svg+xml',
    // Videos
    'mp4': 'video/mp4',
    'webm': 'video/webm',
    'mov': 'video/quicktime',
    'avi': 'video/x-msvideo',
    'mkv': 'video/x-matroska',
    // Audio
    'mp3': 'audio/mpeg',
    'wav': 'audio/wav',
    'ogg': 'audio/ogg',
    'm4a': 'audio/mp4',
    // Documents
    'pdf': 'application/pdf',
    'doc': 'application/msword',
    'docx': 'application/vnd.openxmlformats-officedocument.wordprocessingml.document',
    'txt': 'text/plain',
    // Archives
    'zip': 'application/zip',
    'rar': 'application/x-rar-compressed',
    '7z': 'application/x-7z-compressed',
    // Others
    'json': 'application/json',
    'xml': 'application/xml',
  };
  return mimeTypes[ext] || 'application/octet-stream';
}

function prettyBytes(n) {
  const u = ['B','KB','MB','GB','TB'];
  let i = 0; let v = n;
  while (v >= 1024 && i < u.length - 1) { v /= 1024; i++; }
  return (v < 10 && i > 0 ? v.toFixed(1) : Math.round(v)) + ' ' + u[i];
}

function copy(text) {
  if (navigator.clipboard) {
    navigator.clipboard.writeText(text).then(() => {
      const btn = $('copyLink');
      const original = btn.innerHTML;
      btn.textContent = '✅ Copied';
      btn.style.background = 'var(--accent-green)';
      btn.style.color = 'white';
      setTimeout(() => { btn.innerHTML = '📋 Copy'; btn.style.background=''; btn.style.color=''; }, 1100);
    }).catch(() => { appendSys('Failed to copy link'); });
  }
}

function randCode() {
  const adjectives = ['quantum','neural','cosmic','digital','cyber','nexus','matrix','pulse','flux','zen'];
  const nouns = ['falcon','phoenix','cipher','prism','vector','orbit','spark','wave','node','core'];
  const num = Math.floor(Math.random() * 9000) + 1000;
  return `${adjectives[Math.floor(Math.random()*adjectives.length)]}-${nouns[Math.floor(Math.random()*nouns.length)]}-${num}`;
}

function updateUI(connected) {
  textInput.disabled = !connected; sendBtn.disabled = !connected; fileBtn.disabled = !connected;
  $('createBtn').disabled = connected; $('joinBtn').disabled = connected;
  if (connected) textInput.focus();
}

// Auto-resize textarea
textInput.addEventListener('input', function(){ this.style.height='auto'; this.style.height = Math.min(this.scrollHeight, window.innerHeight*0.3) + 'px'; });

// ---- PeerJS setup ----
let peer = null; let conn = null; let isHost = false; let roomCode = '';

const PEER_CONF = {
  debug: 1,
  config: { iceServers: [ { urls: 'stun:stun.l.google.com:19302' }, { urls: 'stun:stun1.l.google.com:19302' } ] }
};

function createPeer(id) {
  if (peer) { try { peer.destroy(); } catch{}; peer = null; }
  peer = new Peer(id, PEER_CONF);
  peer.on('open', (peerId) => { debugInfo.textContent = `Peer: ${peerId}`; });
  peer.on('error', (err) => { console.error('Peer error:', err); appendSys('⚠️ ' + (err.message || err.type || 'Peer error')); setStatus('Error', 'error'); updateUI(false); });
  peer.on('connection', (connection) => { if (conn) { connection.close(); return; } handleConnection(connection); });
  peer.on('disconnected', () => { setStatus('Disconnected'); updateUI(false); });
  return peer;
}

function hostRoom(code) {
  isHost = true;
  roomCode = code;
  setStatus('Hosting…');
  
  // Save host name for invite overlay
  try { 
    localStorage.setItem('whisper-last-host', currentUsername);
  } catch{}
  
  createPeer(code);
  const link = `${location.origin}${location.pathname}#${encodeURIComponent(code)}`;
  linkOut.value = link;
  roomInput.value = code;
  history.replaceState(null, '', `#${encodeURIComponent(code)}`);
  copy(link);
  
  // Update the invite overlay with current username
  inviteHostName.textContent = currentUsername;
  
  appendSys('Room created! Share your link: ' + code);
  setStatus('Waiting for guest');
  updateUI(false);
}

function joinRoom(code) {
  isHost = false; roomCode = code; setStatus('Connecting…');
  createPeer();
  roomInput.value = code; history.replaceState(null,'',`#${encodeURIComponent(code)}`);
  peer.on('open', () => {
    const connection = peer.connect(code, { reliable: true });
    connection.on('error', (err) => { console.error('Connection error:', err); appendSys('❌ Failed to connect to room: ' + code); setStatus('Connection failed','error'); updateUI(false); });
    handleConnection(connection);
  });
}

function handleConnection(connection) {
  conn = connection;
  connection.on('open', () => {
    if (isHost) {
      appendSys('User joined the room');
      // Update host profile in local UI immediately
      peerProfile = { name: currentUsername, avatar: myAvatarUrl };
      updateContactStrip();
    } else {
      appendSys('Successfully connected');
    }
    setStatus('Connected','connected');
    updateUI(true);
    // Share my profile (name + avatar) immediately
    try { 
      conn.send(JSON.stringify({ 
        type: 'profile', 
        name: currentUsername, 
        avatar: myAvatarUrl 
      })); 
    } catch{}
  });
  connection.on('data', onData);
  connection.on('close', () => { appendSys('Connection ended'); setStatus('Disconnected'); updateUI(false); conn = null; peerProfile = { name: 'Not connected', avatar: 'https://picsum.photos/seed/placeholder/96' }; updateContactStrip(); });
  connection.on('error', () => { appendSys('Connection error occurred'); setStatus('Error','error'); updateUI(false); conn = null; });
  if (!isHost && connection.open) { appendSys('Successfully connected'); setStatus('Connected','connected'); updateUI(true); }
}

// ---- Messaging protocol ----
const CHUNK_SIZE = 16 * 1024;
let incomingFile = null;

function onData(data) {
  if (typeof data === 'string') {
    let msg;
    try { 
      msg = JSON.parse(data);
    } catch {
      console.error('Failed to parse message:', data);
      return;
    }
    
    console.log('Received message type:', msg.type);
    
    switch (msg.type) {
      case 'text':
        // Pass avatar if present, else fallback to peerProfile.avatar
        appendMsg(msg.text, false, msg.username, msg.timestamp, msg.avatar || peerProfile.avatar);
        break;
      case 'fileComplete':
        handleFileComplete(msg);
        break;
      case 'fileStart':
        handleFileStart(msg);
        break;
      case 'fileChunk':
        handleFileChunk(msg);
        break;
      case 'fileEnd':
        handleFileEnd(msg);
        break;
      case 'profile':
        handleProfile(msg);
        break;
      default:
        console.log('Unknown message type:', msg.type);
    }
  }
}

function handleProfile(msg) {
  // Update the remote contact card + header
  peerProfile.name = msg.name || 'Guest';
  if (msg.avatar) {
    peerProfile.avatar = msg.avatar;
    peerProfile._seed = undefined;
  } else {
    // Assign a random seed if not already set
    if (!peerProfile._seed) {
      peerProfile._seed = Math.random().toString(36).slice(2);
    }
    peerProfile.avatar = `https://picsum.photos/seed/${encodeURIComponent(peerProfile._seed)}/96`;
  }
  updateContactStrip();
}

function handleFileStart(msg) {
  console.log('File transfer starting:', msg);
  
  const transferId = `${msg.name}-${Date.now()}`;
  const mimeType = msg.mimeType || getMimeType(msg.name);
  
  console.log('File transfer details:', {
    transferId,
    mimeType,
    originalMimeType: msg.mimeType,
    totalChunks: msg.chunks
  });
  
  incomingFile = { 
    id: transferId, 
    name: msg.name, 
    type: mimeType,
    size: msg.size, 
    chunks: new Array(msg.chunks), // Pre-allocate array for ordered chunks
    received: 0,
    totalChunks: msg.chunks,
    username: msg.username, 
    timestamp: msg.timestamp,
    dataUrlPrefix: msg.dataUrlPrefix, // Store data URL prefix for reconstruction
    progressElement: createFileTransferProgress(transferId, msg.name, msg.size)
  };
  
  console.log('Incoming file object created:', incomingFile);
}

function handleFileComplete(msg) {
  console.log('Received complete file in single message');
  
  try {
    // File data is already a complete data URL
    appendFile(
      msg.name,
      msg.size,
      msg.data, // This is already a complete data URL
      false,
      msg.username,
      msg.timestamp,
      msg.mimeType
    );
    
    console.log('Small file received and displayed successfully');
    
  } catch (error) {
    console.error('Error handling complete file:', error);
    appendSys(`❌ Failed to process "${msg.name}": ${error.message}`);
  }
}

function handleFileChunk(msg) {
  if (!incomingFile) {
    console.warn('Received chunk but no active file transfer');
    return;
  }
  
  try {
    // Store chunk in correct position
    incomingFile.chunks[msg.index] = msg.chunk;
    incomingFile.received++;
    
    console.log('Chunk processed:', {
      index: msg.index,
      chunksReceived: incomingFile.received,
      totalChunks: incomingFile.totalChunks,
      progress: ((incomingFile.received / incomingFile.totalChunks) * 100).toFixed(1) + '%'
    });
    
    // Update progress
    updateFileTransferProgress(
      incomingFile.id,
      (incomingFile.received / incomingFile.totalChunks * 100)
    );
    
  } catch (error) {
    console.error('Error processing chunk:', error);
  }
}

function handleFileEnd(msg) {
  if (!incomingFile) {
    console.warn('Received fileEnd but no active file transfer');
    return;
  }
  
  console.log('File transfer ending:', {
    name: incomingFile.name,
    chunksReceived: incomingFile.received,
    totalChunks: incomingFile.totalChunks
  });
  
  try {
    // Combine all chunks into complete base64 data
    const base64Data = incomingFile.chunks.join('');
    console.log('Chunks combined, total length:', base64Data.length);
    
    // Create complete data URL using the original prefix
    const dataUrl = incomingFile.dataUrlPrefix + base64Data;
    console.log('Data URL created:', {
      prefixLength: incomingFile.dataUrlPrefix.length,
      totalLength: dataUrl.length,
      mimeType: incomingFile.type
    });
    
    // Remove progress element
    if (incomingFile.progressElement) {
      incomingFile.progressElement.remove();
    }
    
    // Append file message
    appendFile(
      incomingFile.name,
      incomingFile.size,
      dataUrl,
      false,
      incomingFile.username,
      incomingFile.timestamp,
      incomingFile.type
    );
    
    console.log('File transfer completed successfully');
    
  } catch (error) {
    console.error('Error handling file completion:', {
      error: error,
      errorName: error.name,
      errorMessage: error.message,
      stack: error.stack
    });
    appendSys(`❌ Failed to process "${incomingFile.name}": ${error.message}`);
  }
  
  incomingFile = null;
}

function sendText() {
  const text = textInput.value.trim(); if (!text || !conn) return;
  conn.send(JSON.stringify({ type:'text', text, username: currentUsername, timestamp: getTimestamp(), avatar: myAvatarUrl }));
  appendMsg(text, true, currentUsername, null, myAvatarUrl);
  textInput.value = ''; textInput.style.height = 'auto';
}

async function sendFile(file) {
  if (!file || !conn) {
    console.log('File sharing abort:', { file: !!file, connection: !!conn });
    return;
  }
  
  try {
    console.log('Starting file send:', {
      name: file.name,
      type: file.type,
      size: file.size,
      lastModified: file.lastModified
    });
    
    // Read file as Data URL for local preview and sending
    const reader = new FileReader();
    const fileDataUrl = await new Promise((resolve, reject) => {
      reader.onload = () => resolve(reader.result);
      reader.onerror = () => reject(reader.error);
      reader.readAsDataURL(file);
    });
    
    console.log('File read as Data URL, length:', fileDataUrl.length);
    
    // Create local preview
    appendFile(file.name, file.size, fileDataUrl, true, currentUsername, null, file.type);
    console.log('Local preview appended to chat');
    
    // Send file data in a single message for smaller files (< 1MB)
    if (file.size < 1024 * 1024) {
      conn.send(JSON.stringify({
        type: 'fileComplete',
        name: file.name,
        mimeType: file.type || getMimeType(file.name),
        size: file.size,
        data: fileDataUrl,
        username: currentUsername,
        timestamp: getTimestamp()
      }));
      console.log('Small file sent in single message');
      return;
    }
    
    // For larger files, split the base64 string into chunks
    const base64Data = fileDataUrl.split(',')[1];
    const chunkSize = 32768; // 32KB chunks of base64 data
    const chunks = Math.ceil(base64Data.length / chunkSize);
    
    // Send start message
    conn.send(JSON.stringify({
      type: 'fileStart',
      name: file.name,
      mimeType: file.type || getMimeType(file.name),
      size: file.size,
      chunks: chunks,
      dataUrlPrefix: fileDataUrl.split(',')[0] + ',', // Send the data URL prefix for reconstruction
      username: currentUsername,
      timestamp: getTimestamp()
    }));
    
    // Send chunks
    for (let i = 0; i < chunks; i++) {
      const chunk = base64Data.slice(i * chunkSize, (i + 1) * chunkSize);
      conn.send(JSON.stringify({
        type: 'fileChunk',
        chunk: chunk,
        index: i,
        total: chunks
      }));
      
      console.log('Chunk sent:', {
        index: i,
        progress: ((i + 1) / chunks * 100).toFixed(1) + '%'
      });
      
      // Small delay between chunks to prevent flooding
      if (i > 0 && i % 10 === 0) {
        await new Promise(r => setTimeout(r, 100));
      }
    }
    
    // Signal completion
    conn.send(JSON.stringify({
      type: 'fileEnd',
      name: file.name,
      size: file.size,
      totalChunks: chunks
    }));
    
    console.log('File send completed successfully:', {
      fileName: file.name,
      totalChunks: chunks
    });
    
  } catch (error) {
    console.error('Error sending file:', {
      error: error,
      errorName: error.name,
      errorMessage: error.message,
      stack: error.stack
    });
    appendSys(`❌ Failed to send "${file.name}": ${error.message}`);
  }
}

// ---- Event Handlers ----
$('createBtn').onclick = () => { const code = roomInput.value.trim() || randCode(); hostRoom(code); };
$('joinBtn').onclick = () => { const code = roomInput.value.trim() || (location.hash ? decodeURIComponent(location.hash.slice(1)) : ''); if (!code) { appendSys('Please enter a room code or use a valid link'); return; } joinRoom(code); };
$('copyLink').onclick = () => { const code = roomInput.value.trim() || (location.hash ? decodeURIComponent(location.hash.slice(1)) : randCode()); const link = `${location.origin}${location.pathname}#${encodeURIComponent(code)}`; copy(link); linkOut.value = link; };
$('sendBtn').onclick = sendText;
textInput.addEventListener('keydown', (e) => { if (e.key === 'Enter' && !e.shiftKey) { e.preventDefault(); sendText(); } });

// File sharing handlers
$('fileBtn').onclick = () => $('fileInput').click();
$('fileInput').onchange = (e) => { 
  const file = e.target.files?.[0]; 
  if (file) sendFile(file); 
  e.target.value = ''; 
};

// File drag & drop handlers
let dragCounter = 0;
['dragenter','dragover'].forEach(evt => {
  messagesEl.addEventListener(evt, (e) => {
    e.preventDefault();
    e.stopPropagation();
  });
});

messagesEl.addEventListener('dragenter', (e) => {
  e.preventDefault();
  dragCounter++;
  messagesEl.classList.add('drag-over');
});

messagesEl.addEventListener('dragleave', (e) => {
  e.preventDefault();
  if (--dragCounter <= 0) {
    dragCounter = 0;
    messagesEl.classList.remove('drag-over');
  }
});

messagesEl.addEventListener('drop', (e) => {
  e.preventDefault();
  e.stopPropagation();
  dragCounter = 0;
  messagesEl.classList.remove('drag-over');
  const file = e.dataTransfer?.files?.[0];
  if (file) sendFile(file);
});

// Auto-join from URL hash
window.addEventListener('load', () => {
  // initialize my display name and avatar card
  meName.textContent = currentUsername;
  meAvatar.src = myAvatarUrl;
  updateContactStrip();

  const code = location.hash ? decodeURIComponent(location.hash.slice(1)) : '';
  if (code) {
    roomInput.value = code;
    appendSys(`Detected room link: ${code}`);
    
    // If joining via link, show invite overlay before joining
    setTimeout(() => {
      if (!peer) {
        // Try to get host name from localStorage (if available)
        let hostName = localStorage.getItem('whisper-last-host') || 'Anonymous';
        
        // Update peer profile immediately for host name
        if (hostName !== 'Anonymous') {
          peerProfile.name = hostName;
          updateContactStrip();
        }
        
        showInviteOverlay(hostName);
        inviteStartBtn.onclick = function() {
          hideInviteOverlay();
          joinRoom(code);
        };
      }
    }, 400);
  }
});

// Invite overlay logic
const inviteOverlay = document.getElementById('inviteOverlay');
const inviteHostName = document.getElementById('inviteHostName');
const inviteStartBtn = document.getElementById('inviteStartBtn');
let inviteHost = 'Anonymous';

function showInviteOverlay(hostName) {
  inviteHostName.textContent = hostName || 'Anonymous';
  inviteOverlay.classList.remove('hidden');
}
function hideInviteOverlay() {
  inviteOverlay.classList.add('hidden');
}
inviteStartBtn.addEventListener('click', () => {
  hideInviteOverlay();
  document.getElementById('homepage').style.display = 'none';
  document.getElementById('appMain').style.display = '';
});

  // Toast notification
function showToast(message, duration = 3000) {
  const toast = document.getElementById('toast');
  if (message) toast.textContent = message;
  toast.classList.add('show');
  setTimeout(() => toast.classList.remove('show'), duration);
}

// Handle landing page start button
document.getElementById('stepperNext').addEventListener('click', () => {
  document.getElementById('homepage').style.display = 'none';
  document.getElementById('appMain').style.display = '';
  
  // Only auto-create room if we're not coming from a shared link
  if (!location.hash) {
    const code = randCode();
    hostRoom(code);
    showToast('Room code copied to clipboard');
  }
});

// Initialize
updateUI(false);
appendSys('Welcome to Whispy!');
usernameInput.focus();
usernameInput.select();

</script>
<style>

/* Light themed landing page */
.homepage-overlay {
  position: fixed;
  inset: 0;
  z-index: 1000;
  background: #ffffff;
  display: flex;
  align-items: center;
  justify-content: center;
  min-height: 100vh;
  width: 100%;
  color: #111111;
  animation: fadeIn 0.7s;
  padding: 20px;
  overflow-y: auto;
  -webkit-overflow-scrolling: touch;
}
/* --- HOMEPAGE OVERLAY: VERTICAL, CENTERED, MOBILE-FIRST --- */
.homepage-content {
  max-width: 1000px;
  width: 100%;
  margin: auto;
  text-align: center;
  display: flex;
  flex-direction: column;
  align-items: center;
  gap: 48px;
  padding: clamp(32px, 5vw, 64px) 24px;
}
.homepage-logo {
  font-size: clamp(64px, 8vw, 96px);
  margin-bottom: 0;
  color: #111111;
  display: flex;
  justify-content: center;
  align-items: center;
  animation: float 6s ease-in-out infinite;
}
.homepage-content h1 {
  font-size: clamp(2.5rem, 5vw, 4rem);
  font-weight: 800;
  margin: 0;
  letter-spacing: -0.03em;
  color: #111111;
  text-align: center;
  line-height: 1.1;
  max-width: 15ch;
}
.homepage-lead {
  font-size: clamp(1.125rem, 2vw, 1.375rem);
  margin: 0;
  color: #555555;
  font-weight: 400;
  text-align: center;
  max-width: 600px;
  line-height: 1.6;
}

@keyframes float {
  0% { transform: translateY(0px); }
  50% { transform: translateY(-10px); }
  100% { transform: translateY(0px); }
}
.homepage-features {
  list-style: none;
  padding: 0;
  margin: 0;
  color: #555555;
  font-size: clamp(1rem, 1.5vw, 1.125rem);
  font-weight: 400;
  display: grid;
  grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
  gap: clamp(20px, 3vw, 32px);
  width: 100%;
  max-width: 1000px;
}
.homepage-features li {
  margin: 0;
  padding: clamp(24px, 4vw, 32px);
  display: flex;
  flex-direction: column;
  align-items: center;
  gap: 16px;
  line-height: 1.6;
  text-align: center;
  background: #ffffff;
  border: 1px solid #e5e7eb;
  border-radius: 16px;
  box-shadow: 0 4px 6px -1px rgb(0 0 0 / 0.05);
  transition: transform 0.2s ease, box-shadow 0.2s ease;
}
.homepage-features li:hover {
  transform: translateY(-2px);
  box-shadow: 0 8px 16px -4px rgb(0 0 0 / 0.1);
}
.homepage-features li span {
  display: block;
  font-size: 2.5em;
  margin-bottom: 4px;
}
.homepage-features li strong {
  font-size: 1.25em;
  color: #111111;
  margin-bottom: 8px;
}
.homepage-features li p {
  margin: 0;
  color: #666666;
}
.homepage-btn {
  font-size: 1.125rem;
  padding: 16px 48px;
  border-radius: 12px;
  background: #111111;
  color: #ffffff;
  border: none;
  font-weight: 600;
  transition: all 0.2s ease;
  text-align: center;
  display: inline-flex;
  align-items: center;
  justify-content: center;
  cursor: pointer;
  box-shadow: 0 4px 6px -1px rgb(0 0 0 / 0.1);
}
.homepage-btn:active {
  transform: scale(0.98);
}
.homepage-btn:focus {
  outline: 2px solid #2563eb;
  outline-offset: 2px;
}
.homepage-footer {
  margin-top: clamp(32px, 5vw, 64px);
  font-size: 0.875rem;
  color: #666666;
  text-align: center;
}
@keyframes fadeIn {
  from { opacity: 0; transform: translateY(10px); }
  to { opacity: 1; transform: none; }
}

.homepage-btn:hover {
  background: #000000;
  transform: translateY(-2px);
  box-shadow: 0 8px 16px -4px rgb(0 0 0 / 0.2);
}

/* Invite overlay styling */
.invite-overlay {
  position: fixed;
  inset: 0;
  z-index: 2000;
  background: rgba(255, 255, 255, 0.98);
  display: flex;
  align-items: center;
  justify-content: center;
  padding: 20px;
  animation: fadeIn 0.5s ease-out;
}

.invite-content {
  background: #ffffff;
  border-radius: 24px;
  padding: clamp(32px, 5vw, 48px);
  max-width: 440px;
  width: 100%;
  text-align: center;
  box-shadow: 0 20px 40px -8px rgb(0 0 0 / 0.15);
  border: 1px solid #e5e7eb;
  display: flex;
  flex-direction: column;
  gap: 24px;
  align-items: center;
}

.invite-logo {
  font-size: 64px;
  animation: float 6s ease-in-out infinite;
}

#inviteTitle {
  font-size: clamp(1.75rem, 3vw, 2.25rem);
  font-weight: 700;
  color: #111111;
  margin: 0;
}

.invite-host {
  font-size: 1.125rem;
  color: #666666;
}

#inviteStartBtn {
  background: #111111;
  color: #ffffff;
  font-size: 1.125rem;
  padding: 16px 32px;
  border-radius: 12px;
  border: none;
  font-weight: 600;
  cursor: pointer;
  transition: all 0.2s ease;
  margin-top: 8px;
}

#inviteStartBtn:hover {
  background: #000000;
  transform: translateY(-2px);
  box-shadow: 0 8px 16px -4px rgb(0 0 0 / 0.2);
}

/* Mobile-first adjustments */
@media (max-width: 768px) {
  .homepage-content {
    gap: 32px;
  }
  .homepage-features {
    grid-template-columns: 1fr;
  }
  .homepage-btn {
    width: 100%;
    max-width: 300px;
  }
  .invite-content {
    margin: 16px;
  }
}

/* Legal overlays styling */
.legal-overlay {
  position: fixed;
  inset: 0;
  z-index: 3000;
  background: rgba(255, 255, 255, 0.98);
  display: none;
  align-items: flex-start;
  justify-content: center;
  padding: 20px;
  overflow-y: auto;
  -webkit-overflow-scrolling: touch;
}

.legal-overlay.show {
  display: flex;
}

.legal-content {
  background: #ffffff;
  border-radius: 24px;
  padding: clamp(32px, 5vw, 48px);
  max-width: 800px;
  width: 100%;
  margin: 40px auto;
  position: relative;
  box-shadow: 0 20px 40px -8px rgb(0 0 0 / 0.15);
  border: 1px solid #e5e7eb;
}

.close-btn {
  position: absolute;
  top: 24px;
  right: 24px;
  width: 40px;
  height: 40px;
  border-radius: 20px;
  border: none;
  background: #f3f4f6;
  color: #666666;
  font-size: 24px;
  cursor: pointer;
  display: flex;
  align-items: center;
  justify-content: center;
  transition: all 0.2s ease;
}

.close-btn:hover {
  background: #e5e7eb;
  color: #111111;
}

.legal-text {
  color: #374151;
  font-size: 1rem;
  line-height: 1.6;
}

.legal-content h2 {
  font-size: clamp(1.75rem, 3vw, 2.25rem);
  color: #111111;
  margin: 0 0 32px 0;
}

.legal-content h3 {
  font-size: 1.25rem;
  color: #111111;
  margin: 32px 0 16px 0;
}

.legal-text ul {
  padding-left: 24px;
  margin: 16px 0;
}

.legal-text li {
  margin-bottom: 8px;
}

.faq-item {
  margin-bottom: 32px;
}

.faq-item h3 {
  font-size: 1.125rem;
  margin: 0 0 12px 0;
}

.faq-item p {
  margin: 0;
}

/* Footer links styling */
.footer-links {
  display: flex;
  align-items: center;
  justify-content: center;
  gap: 8px;
  margin-bottom: 12px;
  flex-wrap: wrap;
}

/* Chat footer */
.chat-footer {
  padding: 8px 16px;
  text-align: center;
  background: var(--bg-secondary);
  border-top: 1px solid var(--border-subtle);
}

.bmc-link {
  display: inline-flex;
  align-items: center;
  gap: 6px;
  color: var(--text-tertiary);
  text-decoration: none;
  font-size: 13px;
  transition: all 0.2s ease;
}

.bmc-link:hover {
  color: var(--text-primary);
  transform: translateY(-1px);
}

.footer-link {
  background: none;
  border: none;
  color: #666666;
  font-size: 0.875rem;
  cursor: pointer;
  padding: 4px 8px;
  transition: color 0.2s ease;
}

.footer-link:hover {
  color: #111111;
}

.footer-dot {
  color: #d1d5db;
  font-size: 0.875rem;
}

.footer-copyright {
  color: #666666;
  font-size: 0.875rem;
}

/* For very small screens */
@media (max-width: 360px) {
  .homepage-content {
    padding: 24px 16px;
    gap: 24px;
  }
  .homepage-features li {
    padding: 20px;
  }
  .invite-content {
    padding: 24px 16px;
  }
  .legal-content {
    padding: 24px 16px;
    margin: 20px auto;
  }
  .close-btn {
    top: 16px;
    right: 16px;
  }
}
</style>
<script>
// Page logic with legal overlays
document.addEventListener('DOMContentLoaded', function() {
  var homepage = document.getElementById('homepage');
  var appMain = document.getElementById('appMain');
  var stepperNext = document.getElementById('stepperNext');
  var privacyOverlay = document.getElementById('privacyOverlay');
  var termsOverlay = document.getElementById('termsOverlay');
  var faqOverlay = document.getElementById('faqOverlay');

  // Start button
  stepperNext.onclick = function() {
    homepage.style.display = 'none';
    appMain.style.display = '';
  };

  // Allow Enter key to start
  document.addEventListener('keydown', function(e) {
    if (homepage.style.display !== 'none' && (e.key === 'Enter' || e.keyCode === 13)) {
      stepperNext.click();
    }
    // Close overlays with Escape key
    if (e.key === 'Escape' || e.keyCode === 27) {
      hidePrivacyPolicy();
      hideTerms();
      hideFAQ();
    }
  });

  // Close overlays when clicking outside content
  [privacyOverlay, termsOverlay, faqOverlay].forEach(overlay => {
    overlay.addEventListener('click', function(e) {
      if (e.target === overlay) {
        overlay.classList.remove('show');
      }
    });
  });
});

// Privacy Policy overlay
function showPrivacyPolicy() {
  document.getElementById('privacyOverlay').classList.add('show');
  document.body.style.overflow = 'hidden';
}

function hidePrivacyPolicy() {
  document.getElementById('privacyOverlay').classList.remove('show');
  document.body.style.overflow = '';
}

// Terms of Service overlay
function showTerms() {
  document.getElementById('termsOverlay').classList.add('show');
  document.body.style.overflow = 'hidden';
}

function hideTerms() {
  document.getElementById('termsOverlay').classList.remove('show');
  document.body.style.overflow = '';
}

// FAQ overlay
function showFAQ() {
  document.getElementById('faqOverlay').classList.add('show');
  document.body.style.overflow = 'hidden';
}

function hideFAQ() {
  document.getElementById('faqOverlay').classList.remove('show');
  document.body.style.overflow = '';
}
</script>
</body>
</html>